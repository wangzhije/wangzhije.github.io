import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as r,c as i,b as n,d as e,e as s,f as t}from"./app-a98e131c.js";const c={},p=n("h1",{id:"package-包管理工具",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#package-包管理工具","aria-hidden":"true"},"#"),e(" package 包管理工具")],-1),d=n("h2",{id:"常用-package-包管理器",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#常用-package-包管理器","aria-hidden":"true"},"#"),e(" 常用 package 包管理器")],-1),u={href:"https://docs.npmjs.com/",target:"_blank",rel:"noopener noreferrer"},m={href:"https://docs.npmjs.com/cli/v8/using-npm/scripts#life-cycle-operation-order",target:"_blank",rel:"noopener noreferrer"},h=n("li",null,"cnpm",-1),v={href:"https://classic.yarnpkg.com/en/docs",target:"_blank",rel:"noopener noreferrer"},k={href:"https://www.pnpm.cn/",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/lerna/lerna",target:"_blank",rel:"noopener noreferrer"},_=t(`<h2 id="限制-package-管理器" tabindex="-1"><a class="header-anchor" href="#限制-package-管理器" aria-hidden="true">#</a> 限制 package 管理器</h2><p>包管理器太多，项目成员可能习惯使用的包管理器不同<br> 规范化，则需要项目中限制使用<br> 主要是为了避免项目依赖安装出错，保证项目能够正常运行</p><blockquote><p>原理【包管理器】执行 <code>install</code> 时调用 <code>preinstall</code> hooks<br> 注意：【npm | yarn | cnpm | pnpm】 hooks 调用时机可能不同</p></blockquote><h3 id="only-allow-一句代码-统一项目包管理工具" tabindex="-1"><a class="header-anchor" href="#only-allow-一句代码-统一项目包管理工具" aria-hidden="true">#</a> only-allow：一句代码，统一项目包管理工具</h3><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;preinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npx only-allow yarn&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>问题</p><ol><li>yarn 和 npm 的 preinstall hook 调用时机不同 <ul><li><code>npm</code> 只会在 <code>npm install</code> 安装整个项目依赖时调用</li><li><code>npm install &lt;package&gt;</code>安装单个 package 时不调用；所以不会执行，也就无法限制使用 npm 安装</li></ul></li></ol><h3 id="自定义" tabindex="-1"><a class="header-anchor" href="#自定义" aria-hidden="true">#</a> 自定义</h3><p>Vue3 源码</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token comment">// package.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;preinstall&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node ./scripts/preinstall.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-JavaScript line-numbers-mode" data-ext="JavaScript"><pre class="language-JavaScript"><code>// preinstall.js
const isPnpm = /pnpm/.test(p<wbr>rocess.env.npm_execpath || &#39;&#39;)
if (!isPnpm) {
  console.warn(&#39;当前包管理器不是 pnpm&#39;); // 命令行打印信息
  process.exit(1); // 错误退出 node 命令行
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11);function g(f,x){const a=o("ExternalLinkIcon");return r(),i("div",null,[p,d,n("ul",null,[n("li",null,[e("npm "),n("ul",null,[n("li",null,[n("a",u,[e("npm 官方文档"),s(a)])]),n("li",null,[n("a",m,[e("npm 生命周期"),s(a)])])])]),h,n("li",null,[e("yarn "),n("ul",null,[n("li",null,[n("a",v,[e("yarn 官方文档"),s(a)])])])]),n("li",null,[e("pnpm "),n("ul",null,[n("li",null,[n("a",k,[e("pnpm 官方文档"),s(a)])])])]),n("li",null,[e("Lerna 多包管理 "),n("ul",null,[n("li",null,[n("a",b,[e("Lerna 官方文档"),s(a)])])])])]),_])}const j=l(c,[["render",g],["__file","index.html.vue"]]);export{j as default};
